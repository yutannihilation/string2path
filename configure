# Even when `cargo` is on `PATH`, `rustc` might not. We need to source
# ~/.cargo/env to ensure PATH is configured correctly.
# (c.f. https://github.com/yutannihilation/string2path/issues/4)
if [ -e "${HOME}/.cargo/env" ]; then
  . "${HOME}/.cargo/env"
fi

"${R_HOME}/bin/Rscript" "./tools/configure.R"

ret=$?

case $ret in
0)
  sed -e 's|@CLEAN_EXTRA@|$(STATLIB)|' src/Makevars.in > src/Makevars
  exit 0
  ;;
100)
  sed -e 's|@CLEAN_EXTRA@||' src/Makevars.in > src/Makevars
  exit 0
  ;;
*)
  exit $ret
esac
